<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Snake Game</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a1a2e;
    color: #eee;
    font-family: 'Segoe UI', system-ui, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    overflow: hidden;
    touch-action: manipulation;
    -webkit-user-select: none;
    user-select: none;
  }
  h1 {
    font-size: 1.4rem;
    margin-bottom: 0.3rem;
    color: #e94560;
    letter-spacing: 2px;
    text-transform: uppercase;
  }
  #score {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: #0f3460;
    background: #e94560;
    padding: 0.2rem 1rem;
    border-radius: 4px;
    font-weight: bold;
  }
  #game-canvas {
    border: 2px solid #0f3460;
    border-radius: 4px;
    background: #16213e;
    display: block;
    max-width: 95vw;
    max-height: 50vh;
  }
  #overlay {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }
  #overlay.active { pointer-events: auto; }
  #overlay-bg {
    display: none;
    flex-direction: column;
    align-items: center;
    background: rgba(26, 26, 46, 0.92);
    padding: 2rem 2.5rem;
    border-radius: 12px;
    border: 2px solid #e94560;
  }
  #overlay.active #overlay-bg { display: flex; }
  #overlay-bg h2 { color: #e94560; margin-bottom: 0.5rem; font-size: 1.5rem; }
  #overlay-bg p { margin-bottom: 1rem; font-size: 1rem; }
  #restart-btn, #start-btn {
    background: #e94560;
    color: #fff;
    border: none;
    padding: 0.7rem 2rem;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    letter-spacing: 1px;
  }
  #restart-btn:active, #start-btn:active { background: #c73450; }

  .dpad {
    margin-top: 0.8rem;
    display: grid;
    grid-template-areas:
      ".  up  ."
      "left . right"
      ". down .";
    grid-template-columns: repeat(3, 64px);
    grid-template-rows: repeat(3, 64px);
    gap: 6px;
  }
  .dpad button {
    background: #0f3460;
    color: #e94560;
    border: 2px solid #e94560;
    border-radius: 10px;
    font-size: 1.6rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
  }
  .dpad button:active { background: #e94560; color: #fff; }
  .dpad .up    { grid-area: up; }
  .dpad .down  { grid-area: down; }
  .dpad .left  { grid-area: left; }
  .dpad .right { grid-area: right; }

  @media (max-width: 480px) {
    h1 { font-size: 1.1rem; }
    .dpad { grid-template-columns: repeat(3, 56px); grid-template-rows: repeat(3, 56px); }
  }
</style>
</head>
<body>
  <h1>Snake</h1>
  <div id="score">Score: 0</div>
  <div style="position:relative; display:inline-block;">
    <canvas id="game-canvas" width="400" height="400"></canvas>
    <div id="overlay" class="active">
      <div id="overlay-bg">
        <h2 id="overlay-title">Snake</h2>
        <p id="overlay-msg">Press Start or use arrow keys</p>
        <button id="start-btn">Start</button>
      </div>
    </div>
  </div>
  <div class="dpad">
    <button class="up" data-dir="up">&#9650;</button>
    <button class="left" data-dir="left">&#9664;</button>
    <button class="right" data-dir="right">&#9654;</button>
    <button class="down" data-dir="down">&#9660;</button>
  </div>

<script>
(function() {
  const canvas = document.getElementById('game-canvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlay-title');
  const overlayMsg = document.getElementById('overlay-msg');
  const startBtn = document.getElementById('start-btn');

  const GRID = 20;
  let cols, rows, cellSize;
  let snake, dir, nextDir, food, score, running, animId, lastTime, speed;

  function resize() {
    const maxW = Math.min(window.innerWidth * 0.95, 400);
    const maxH = Math.min(window.innerHeight * 0.48, 400);
    const size = Math.floor(Math.min(maxW, maxH));
    canvas.width = size;
    canvas.height = size;
    cellSize = size / GRID;
    cols = GRID;
    rows = GRID;
    // position overlay
    overlay.style.width = size + 'px';
    overlay.style.height = size + 'px';
    overlay.style.top = canvas.offsetTop + 'px';
    overlay.style.left = canvas.offsetLeft + 'px';
  }

  function init() {
    const mid = Math.floor(GRID / 2);
    snake = [{x: mid, y: mid}, {x: mid - 1, y: mid}, {x: mid - 2, y: mid}];
    dir = {x: 1, y: 0};
    nextDir = {x: 1, y: 0};
    score = 0;
    speed = 130;
    scoreEl.textContent = 'Score: 0';
    placeFood();
  }

  function placeFood() {
    let pos;
    do {
      pos = {x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows)};
    } while (snake.some(s => s.x === pos.x && s.y === pos.y));
    food = pos;
  }

  function update() {
    dir = {...nextDir};
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

    if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows ||
        snake.some(s => s.x === head.x && s.y === head.y)) {
      gameOver();
      return;
    }

    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
      score++;
      scoreEl.textContent = 'Score: ' + score;
      if (speed > 60) speed -= 2;
      placeFood();
    } else {
      snake.pop();
    }
  }

  function draw() {
    ctx.fillStyle = '#16213e';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // draw grid lines subtly
    ctx.strokeStyle = 'rgba(15,52,96,0.3)';
    ctx.lineWidth = 0.5;
    for (let i = 0; i <= GRID; i++) {
      ctx.beginPath(); ctx.moveTo(i * cellSize, 0); ctx.lineTo(i * cellSize, canvas.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0, i * cellSize); ctx.lineTo(canvas.width, i * cellSize); ctx.stroke();
    }

    // food
    const fx = food.x * cellSize + cellSize / 2;
    const fy = food.y * cellSize + cellSize / 2;
    ctx.fillStyle = '#e94560';
    ctx.beginPath();
    ctx.arc(fx, fy, cellSize * 0.4, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(233,69,96,0.25)';
    ctx.beginPath();
    ctx.arc(fx, fy, cellSize * 0.6, 0, Math.PI * 2);
    ctx.fill();

    // snake
    snake.forEach(function(seg, i) {
      const r = i === 0 ? 6 : 4;
      const x = seg.x * cellSize;
      const y = seg.y * cellSize;
      const pad = 1;
      ctx.fillStyle = i === 0 ? '#4ecca3' : '#36b08a';
      ctx.beginPath();
      ctx.roundRect(x + pad, y + pad, cellSize - pad * 2, cellSize - pad * 2, r);
      ctx.fill();
    });
  }

  function gameLoop(ts) {
    if (!running) return;
    animId = requestAnimationFrame(gameLoop);
    if (!lastTime) lastTime = ts;
    if (ts - lastTime >= speed) {
      lastTime = ts;
      update();
      if (running) draw();
    }
  }

  function startGame() {
    overlay.classList.remove('active');
    init();
    running = true;
    lastTime = 0;
    draw();
    animId = requestAnimationFrame(gameLoop);
  }

  function gameOver() {
    running = false;
    cancelAnimationFrame(animId);
    overlayTitle.textContent = 'Game Over';
    overlayMsg.textContent = 'Score: ' + score;
    startBtn.textContent = 'Play Again';
    overlay.classList.add('active');
  }

  function setDir(dx, dy) {
    if (!running) { startGame(); return; }
    if (dir.x === -dx && dir.y === -dy) return; // prevent reverse
    nextDir = {x: dx, y: dy};
  }

  // keyboard
  document.addEventListener('keydown', function(e) {
    switch(e.key) {
      case 'ArrowUp':    case 'w': case 'W': e.preventDefault(); setDir(0, -1); break;
      case 'ArrowDown':  case 's': case 'S': e.preventDefault(); setDir(0,  1); break;
      case 'ArrowLeft':  case 'a': case 'A': e.preventDefault(); setDir(-1, 0); break;
      case 'ArrowRight': case 'd': case 'D': e.preventDefault(); setDir(1,  0); break;
    }
  });

  // d-pad
  document.querySelectorAll('.dpad button').forEach(function(btn) {
    function handle(e) {
      e.preventDefault();
      switch(btn.dataset.dir) {
        case 'up':    setDir(0, -1); break;
        case 'down':  setDir(0,  1); break;
        case 'left':  setDir(-1, 0); break;
        case 'right': setDir(1,  0); break;
      }
    }
    btn.addEventListener('touchstart', handle, {passive: false});
    btn.addEventListener('mousedown', handle);
  });

  startBtn.addEventListener('click', startGame);

  window.addEventListener('resize', function() { resize(); if (!running) draw(); });
  resize();
  init();
  draw();
})();
</script>
</body>
</html>
